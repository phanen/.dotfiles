#!/usr/bin/env shsxh

# /usr/share/doc/bspwm/examples/sxhkdrc
# don't use xdotool, maybe collide with kmonad

# control
super + {_, ctrl +} z
	{pkill -USR1 -x sxhkd, bspc wm -r; pkill polybar; polybar -r;}
super + {_, ctrl +} q
	bspc {node -c, quit}

# navigate
super + {j, k}
	bspc node -f {next, prev}.local.!hidden.window
super + {f, e}
	bspc desktop -f {next, prev}
	# bspc desktop -f {next, prev}.local
super + r
	bspc desktop -f last
super + Tab
	bspc desktop -f last
super + w
	(bspc node -f biggest.window.local && \
		bspc node -f last.window.local && \
		bspc node -s biggest.window.local) || \
	(bspc node -f last.window.local && bspc node -s biggest.window.local)
super + {o, i}
	bspc wm -h off; \
	bspc node -f {older, newer}; \
	bspc wm -h on

# move
super + ctrl + {j, k}
	bspc node -d {next, prev} --follow
super + ctrl + shift + {j, k}
	bspc node -d {next, prev}
super + shift + {j, k}
	bspc desktop -s {next, prev} -f; bspc monitor -d 1 2 3 4 5 6 0
# super + alt + {p, b, w, e}
# 	bspc node -f @{parent, brother, first, second}

# tag num
super + {1-6, 0}
	bspc desktop -f '^{1-7}'
super + shift + {1-6, 0}
	bspc node -d '^{1-7}' --follow
super + ctrl + {1-6, 0}
	bspc node -d '^{1-7}'

# status switch
super + g
	bspc desktop -l next
super + m
	bspc desktop -l next

super + shift + f
	bspc node -t \~floating
super + y
	bspc node -t \~pseudo_tiled
super + shift + y
	bspc node -t \~tiled
# hide
# super + {_, alt + } v
# 	bspc node {-g hidden, ${bspc query -N -n .hidden | tail -n1} -g hidden=off}
# super + d
	# sh $XDG_CONFIG_HOME/sxhkd/scripts/toggle-hidden.sh

# resize
super + ctrl + {h, l}
	bspc node -z {left -20 0 || bspc node -z right -20 0, \
				right 20 0 || bspc node -z left 20 0}

super + shift + {m, comma, period, slash}
		bspc node -z {left -20 0 || bspc node -z right -20 0, \
					bottom 0 20 || bspc node -z top 0 20, \
				top 0 -20 || bspc node -z bottom 0 -20, \
				right 20 0 || bspc node -z left 20 0}
super + shift + {u, i, o, p}
	bspc node -z {right -20 0 || bspc node -z left -20 0, \
				top 0 20 || bspc node -z bottom 0 20, \
				bottom 0 -20 || bspc node -z top 0 -20, \
				left 20 0 || bspc node -z right 20 0}

# misc
# rotation
super + shift + r
    bspc node @/ -R 90
super + shift + e
    bspc node @parent -R 90
super + ctrl + t
	sh $XDG_CONFIG_HOME/sxhkd/scripts/toggle-polybar.sh
# super + shift + c
# 	bsp-layout set tall

# launch
super + n
	alacritty --working-directory ~
super + c
	alacritty --working-directory ~
super + semicolon
	rofi -show drun -matching fuzzy
super + p
	CM_LAUNCHER=rofi clipmenu
super + u
	~/bin/tabexec.sh alacritty msg create-window
super + slash
	alacritty --working-directory ~ --command nvim todo.md
# super + apostrophe
# 	~/bin/tabexec.sh eval "$(dmenu_path | rofi -dmenu)"
	# ~/bin/tabexec.sh rofi -show run -matching fuzzy
	# id=$(bspc query -N -n focused); tabc autoattach $id; rofi -show run -matching fuzzy; sleep 0.3; tabc autoattach $id;
# super + w
# 	rofi -show window -matching fuzzy
	# FIXME kitty --detach --working-directory ~/notes nvim ~/notes/todo.md
# super + t
	# dex --term alacritty /usr/share/applications/vifm.desktop
# super + {z, x, c}
# 	{scrcpy, walrnd, darkman toggle}

super + {minus, equal}
	dbus-send --print-reply --dest=org.mpris.MediaPlayer2.com.gitee.gmg137.NeteaseCloudMusicGtk4 /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.{Previous,Next}
super + BackSpace
	dbus-send --print-reply --dest=org.mpris.MediaPlayer2.com.gitee.gmg137.NeteaseCloudMusicGtk4 /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause
# super + t
# 	tabc create $(bspc query -N -n focused)
# 	id=$(bspc query -N -n); \
# 	[[ "$(tabc printclass $id)" == "tabbed" ]] \
# 	&& tabc detach $id \
# 	|| tabc create $id
	## tabc autoattach $(bspc query -N -n focused)
# super + Tab
# 	dunstctl close-all

super + plus
	bspc node @/ --equalize
super + underscore
	bspc node @/ --balance

# proxy via kmonad
super + {F1, F2}
	sound-control {down, up}
super + {F3, F4}
	light-control {down, up}
super + {F5, F6, F7, F8}
	xrandr -o {left, right, normal, inverted}
super + F9
	flameshot gui
super + F10
	picgo -p http://127.0.0.1:7890 u | tail -n1 | tr -d "\n" | xsel -b && notify-send finish
super + shift + bracketleft
	flameshot gui -r | imgur.sh
super + bracketright
	slip --stop || slip --gif
super + F11
	~/bin/toggle-touchpad.sh
