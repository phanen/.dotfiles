#!/bin/sh

# TODO: reattach to neovide after restart
ROOT=$HOME/b/neovim
MAGIC=123
ARGS+=--luamod-dev

if command -v $ROOT/build/bin/nvim 1>/dev/null 2>/dev/null; then
  VIMRUNTIME=$ROOT/runtime
  NVIM_BIN=$ROOT/build/bin/nvim
elif command -v /bin/nvim; then
  NVIM_BIN=/bin/nvim
else
  exit
fi

# . /usr/share/makepkg/util/message.sh
# colorize
# msg "$NVIM_BIN"

# $ARGS then $@: if `--` in "$@"
# "" is required for sh -c 'nvim xx'
VIMRUNTIME=$VIMRUNTIME $NVIM_BIN "$ARGS" "$@"

builtin test $? != $MAGIC && exit

exec $0 "+so /tmp/reload.vim"
